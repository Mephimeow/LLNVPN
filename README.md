
# multi-vpn-manager

Утилита-скрипт для Debian, создающая несколько изолированных сетевых пространств (`ip netns`) с NAT и системными «алиасами» для удобного запуска команд через нужный namespace. Позволяет одновременно держать несколько VPN-сессий и пользоваться всеми инструментами из основного окружения.

## Возможности

- Создание множества namespace: `vpn1`, `vpn2`, …  
- Авто-настройка veth, адресов, маршрутов и NAT (iptables MASQUERADE).
- Системные обёртки в `/usr/local/bin`:
  - `vpn<ID>` — запускает команды в namespace **от вашего пользователя**.
  - `vpn<ID>-root` — запускает команды в namespace **от root**.
- Команды `list`, `status`, `help` прямо в интерфейсе скрипта.
- Корректная очистка: удаляются netns, veth и обёртки при выходе/`Ctrl+C`.
- Безопасный обработчик сигналов: одинарная очистка и немедленное завершение.

## Требования

- Linux с `iproute2`, `iptables` (подходит iptables-nft), `curl`.
- Права `root` для запуска скрипта.
- (Рекоменд.) Запись в `sudoers`, чтобы обёртка работала без пароля (см. ниже).

## Установка

1. Сохраните скрипт как, например, `multi-vpn-manager.sh`.
2. Сделайте исполняемым:
   
   chmod +x ./multi-vpn-manager.sh
   
3. Запускайте **от root**:
   
   sudo ./multi-vpn-manager.sh
   

## Настройка sudoers (обязательно для удобного использования)

Чтобы обёртки `vpn<ID>` могли выполнять команды без постоянного запроса пароля, необходимо добавить правило в `sudoers`.

Откройте редактор конфигурации sudo:


sudo visudo

Добавьте строку (замените `USER` на ваш логин):

USER ALL=(ALL:ALL) NOPASSWD: /sbin/ip netns exec *

Это правило разрешает вашему пользователю вызывать `ip netns exec` без запроса пароля.  

- `vpn<ID>` будет запускать команды от имени пользователя.  
- `vpn<ID>-root` будет выполнять команды в namespace от root.  

Без этого правила все вызовы через `vpn<ID>` будут требовать пароль sudo.

**Важно:** скрипт *не изменяет sudoers автоматически*, это нужно сделать вручную.

## Использование

Запустите менеджер:

sudo ./multi-vpn-manager.sh


При старте доступна команда `help`.  

### Примеры

Создать namespace:

Введите команду: 1
➕ Создаю vpn1
✅ Namespace vpn1 готов.
   Используй: vpn1 <команда> (от юзера)
           или: vpn1-root <команда> (от root)


Проверить внешний IP:

vpn1 curl ifconfig.me


Запустить VPN:

vpn1-root openvpn --config /etc/openvpn/client/vpn1.ovpn


Показать список ns:

Введите команду: list


Проверить статус:

Введите команду: status


Выйти (и очистить всё):

Введите команду: quit


## Удаление

Скрипт не ставит ничего «навечно». Для ручной очистки:

sudo ip netns del vpn1
sudo ip link del veth_vpn1_host
sudo rm -f /usr/local/bin/vpn1 /usr/local/bin/vpn1-root


## Лицензия

MIT
